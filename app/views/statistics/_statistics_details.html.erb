<div class="statistics_head">
  <% if !@all_tags.nil? && @all_tags.length != 0  %>
      <div class="sh_choose">
        <% @all_tags.each do |tag| %>
            <% if tag[:tag_name]  == @all_tags[0][:tag_name]%>
                <a href="javascript:void(0);" onclick="show_tag_task('<%= @current_task.created_at.strftime("%Y-%m-%d") %>',<%= tag[:tag_id] %>','<%= tag[:pub_id] %>')" class="hover">
                  <%= tag[:tag_name] %>
                </a>
            <% else %>
                <a href="javascript:void(0);" onclick="show_tag_task('<%= @current_task.created_at.strftime("%Y-%m-%d") %>','<%= tag[:tag_id] %>','<%= tag[:pub_id] %>')" >
                  <%= tag[:tag_name] %>
                </a>
            <% end %>
        <% end %>
      </div>
  <% end %>
  <div class="sh_date">
    <input id="today_date" type="hidden"  value="<%= @today_date %>">
    <input id="current_date" type="hidden" value="<%= @current_date %>" >
    <span class="prev" onclick="checkout_date(this,'<%= params[:school_class_id] %>')" >prev</span>
    <p>
      <% if @current_task.nil? %>
          <% if @current_date.nil? %>
            <%= "#{@today_date.to_s.gsub("-",'/')}当日无作业" %>
          <% else %>
            <%= "#{@current_date.to_s.gsub("-",'/')}当日无作业" %>
          <% end %>
      <% else %>
        <%= "#{@current_task.created_at.strftime("%Y/%m/%d")}作业完成情况" %>
      <% end %>
    </p>
    <span class="next" onclick="checkout_date(this,'<%= params[:school_class_id] %>')" >next</span>
  </div>
  <div class="sh_dateIcon"><a href="javascript:void(0);" class="tooltip_html">选择日期</a></div>
</div>
<% if !@current_task.nil? %>
    <div class="statistics_body">
      <div class="sb_classify">
        <ul>
          <li class="complete">
            <h1>完成率</h1>
            <div class="statistics_img"><img src="/assets/new/95.jpg"><%= @average_complete_rate  %></div>
            <div class="sc_nav"><a href="javascript:void(0);" class="hover" id="complete_btn">学员</a></div>
          </li>
          <li class="correct">
            <h1>正确率</h1>
            <div class="statistics_img"><img src="/assets/new/85.jpg"><%= @average_correct_rate  %></div>
            <div class="sc_nav"><a href="javascript:void(0);" id="correct_btn">学员</a><a href="javascript:void(0);">题型</a></div>
          </li>
        </ul>
      </div>

      <div class="sb_table">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" id="complete_table">
          <thead>
          <tr>
            <th width="200">学员</th>
            <% if @question_types.nil? %>
                <th>&nbsp;&nbsp;&nbsp;&nbsp;</th>
            <% else %>
                <% @question_types.each do |type| %>
                    <th><%= Question::TYPES_NAME[type.to_i]  %></th>
                <% end %>
            <% end %>
            <th><a href="javascript:void(0);" class="th_sort tooltip_title" title="点击排序">完成率</a></th>
          </tr>
          </thead>
          <tbody>
          <% if @details.nil? %>
              <tr><td colspan="3" style="width: auto">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
          <% else %>
              <% @details.each do |student|  %>
                  <tr>
                    <td width="200"><div class="td_user"><img src="<%= student[:avatar_url] %>"><%= student[:name] %></div></td>
                    <% @question_types.each do |type| %>
                        <% if student[:answer_details].nil? %>
                            <td><em>-</em></td>
                        <% else %>
                            <% if student[:answer_details][type.to_i].nil? %>
                                <td><em>-</em></td>
                            <% else %>
                                <td><img src="/assets/new/d.png"><em><%= student[:answer_details][type.to_i][0][:used_time] %></M></em></td>
                            <% end %>
                        <% end %>
                    <% end %>
                    <td><%= student[:average_complete_rate] %>%</td>
                  </tr>
              <% end %>
          <% end %>
          </tbody>
        </table>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" id="correct_table" style="display: none;">
          <thead>
          <tr>
            <th width="200">学员</th>
            <% if @question_types.nil? %>
                <th>&nbsp;&nbsp;&nbsp;&nbsp;</th>
            <% else %>
                <% @question_types.each do |type| %>
                    <th><%= Question::TYPES_NAME[type.to_i]  %></th>
                <% end %>
            <% end %>
            <th><a href="javascript:void(0);" class="th_sort tooltip_title" title="点击排序">正确率</a></th>
          </tr>
          </thead>
          <tbody>
          <% if @details.nil? %>
              <tr><td colspan="3" style="width: auto">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
          <% else %>
              <% @details.each do |student|  %>
                  <tr>
                    <td width="200"><div class="td_user"><img src="<%= student[:avatar_url] %>"><%= student[:name] %></div></td>
                    <% @question_types.each do |type| %>
                        <% if student[:answer_details].nil? %>
                            <td><em>-</em></td>
                        <% else %>
                            <% if student[:answer_details][type.to_i].nil? %>
                                <td><em>-</em></td>
                            <% else %>
                                <td>
                                  <div class="td_ratio">
                                    <%= student[:answer_details][type.to_i][0][:correct_rate] %>%
                                    <% if student[:answer_details][type.to_i][0][:correct_rate] < 100 %>
                                        <a href="javascript:void(0);" class="td_seeQuestion tooltip_html">点击查看</a>
                                    <% end %>
                                  </div>
                                  <em>
                                    <%= student[:answer_details][type.to_i][0][:used_time] %>
                                    </M>
                                  </em>
                                </td>
                            <% end %>
                        <% end %>
                    <% end %>
                    <td><%= student[:average_correct_rate] %>%</td>
                  </tr>
              <% end %>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
<% else %>
    <div class="statistics_body" style="height: 400px;">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" >
        <tr style="height: 80px;">
          <td style="text-align: center">暂无数据</td>
        </tr>
      </table>
    </div>
<% end %>
<script>
  $("#complete_btn").click(function(){
      $("#correct_table").hide();
      $("#complete_table").show();
  })

  $("#correct_btn").click(function(){
      $("#complete_table").hide();
      $("#correct_table").show();
  })
</script>